var XBBCODE=(function(){"use strict";var s3_assets_path='https://';var me={},urlPattern=/^(http|mailto)/,imgPattern=/^http/,colorNamePattern=/^(?:red|green|blue|orange|yellow|black|white|brown|gray|silver|purple|maroon|fushsia|lime|olive|navy|teal|aqua)$/,colorCodePattern=/^#?[a-fA-F0-9]{6}$/,tags,tagList,tagsNoParseList=[],bbRegExp,pbbRegExp,pbbRegExp2,openTags,closeTags;tags={"b":{openTag:function(params,content){return '<strong>';},closeTag:function(params,content){return '</strong>';}},"bbcode":{openTag:function(params,content){return '';},closeTag:function(params,content){return '';}},"code":{openTag:function(params,content){return '<span class="xbbcode-code">';},closeTag:function(params,content){return '</span>';},noParse:true},"color":{openTag:function(params,content){var colorCode=params.substr(1)||"black";colorNamePattern.lastIndex=0;colorCodePattern.lastIndex=0;if(!colorNamePattern.test(colorCode)){if(!colorCodePattern.test(colorCode)){colorCode="black";}else{if(colorCode.substr(0,1)!=="#"){colorCode="#"+colorCode;}}}
return '<span style="color:'+colorCode+'">';},closeTag:function(params,content){return '</span>';}},"i":{openTag:function(params,content){return '<i>';},closeTag:function(params,content){return '</i>';}},"img":{openTag:function(params,content){var myUrl=content;urlPattern.lastIndex=0;if(!imgPattern.test(myUrl)){myUrl="";}
return '<img src="'+myUrl+'" class="imgw" alt="" border="0" />';},closeTag:function(params,content){return '';},displayContent:false},"email":{openTag:function(params,content){var myUrl;if(!params){myUrl=content.replace(/<.*?>/g,"");}else{myUrl=params.substr(1);}
return '<a href="mailto:'+myUrl+'" class="popup custom_color" rel="nofollow">';},closeTag:function(params,content){return '</a>';}},"cmimg":{openTag:function(params,content){var path=content.replace(/<.*?>/g,"");var pathArray=path.split("/");if(pathArray.length==2){return '<img src="'+s3_assets_path+pathArray[0]+'cm.classmarker.com/'+pathArray[1]+'" class="imgw" alt="" border="0" />';}},closeTag:function(params,content){return '';},displayContent:false},"cmvideo":{openTag:function(params,content){return '<video  data-cmvideo-url="'+content+'" width="560" height="315" controls controlsList="nodownload"> <source class="sceditor-ignore" src="'+getDocPathForDropDown(content)+'" type="video/mp4">'+audio_video_warning+'</video>';},closeTag:function(params,content){return '';},displayContent:false},"exvideo":{openTag:function(params,content){return '<video data-exvideo-url="'+content+'" width="560" height="315" controls controlsList="nodownload"> <source class="sceditor-ignore" src="'+content+'" type="video/mp4">'+audio_video_warning+'</video>';},closeTag:function(params,content){return '';},displayContent:false},"cmaudio":{openTag:function(params,content){var path=content.replace(/<.*?>/g,"");var pathArray=path.split("/");if(pathArray.length==2){return '<audio data-cmaudio-url="'+path+'" controls controlsList="nodownload"> <source class="sceditor-ignore" src="'+getDocPathForDropDown(path)+'" type="audio/mpeg">'+audio_video_warning+'</audio>';}},closeTag:function(params,content){return '';},displayContent:false},"exaudio":{openTag:function(params,content){return '<audio data-exaudio-url="'+content+'" controls controlsList="nodownload"> <source class="sceditor-ignore" src="'+content+'" type="audio/mpeg">'+audio_video_warning+'</audio>';},closeTag:function(params,content){return '';},displayContent:false},"soundcloud":{openTag:function(params,content){if(typeof isMSIE8!=='undefined'){return audio_video_warning;}else{return '<div class="video-container"><iframe width="600" height="160" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?visual=true&url='+content+'&show_artwork=true&auto_play=false&maxheight=160&maxwidth=600"></iframe></div>';}},closeTag:function(params,content){return '';},displayContent:false},"cmdoc":{openTag:function(params,content){var path=params.substr(1);var pathArray=path.split("/");if(pathArray.length==2){return '<a href="'+s3_assets_path+pathArray[0]+'cm.classmarker.com/'+pathArray[1]+'" class="popup custom_color" rel="nofollow">';}else{return '<a href="javascript:alert(\'Invalid document link.\');">';}},closeTag:function(params,content){return '</a>';},displayContent:true},"ul":{openTag:function(params,content){return '<ul>';},closeTag:function(params,content){return '</ul>';},restrictChildrenTo:["*","li"]},"ol":{openTag:function(params,content){return '<ol>';},closeTag:function(params,content){return '</ol>';},restrictChildrenTo:["*","li"]},"li":{openTag:function(params,content){return "<li>";},closeTag:function(params,content){return "</li>";},restrictParentsTo:["ul","li"]},"s":{openTag:function(params,content){return '<del>';},closeTag:function(params,content){return '</del>';}},"sup":{openTag:function(params,content){return '<span class="sup">';},closeTag:function(params,content){return '</span>';}},"sub":{openTag:function(params,content){return '<span class="sub">';},closeTag:function(params,content){return '</span>';}},"sqr":{openTag:function(params,content){return '&radic;<span class="sqr"> ';},closeTag:function(params,content){return '</span>';}},"font":{openTag:function(params,content){var myFont=params.substr(1);return '<span class="bbcodeFont'+myFont+'"> ';},closeTag:function(params,content){return '</span>';}},"size":{openTag:function(params,content){var mySize=parseInt(params.substr(1),10)||0;if(mySize<1||mySize>7){mySize=2;}
return '<span class="bbcodeSize'+mySize+'">';},closeTag:function(params,content){return '</span>';}},"table":{openTag:function(params,content){return '<div class="cm-table-responsive"><table class="bbcodeTable">';},closeTag:function(params,content){return '</table></div>';},restrictChildrenTo:["tbody","thead","tfoot","tr"]},"tbody":{openTag:function(params,content){return '<tbody>';},closeTag:function(params,content){return '</tbody>';},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},"tfoot":{openTag:function(params,content){return '<tfoot>';},closeTag:function(params,content){return '</tfoot>';},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},"thead":{openTag:function(params,content){return '<thead>';},closeTag:function(params,content){return '</thead>';},restrictChildrenTo:["tr"],restrictParentsTo:["table"]},"td":{openTag:function(params,content){return '<td>';},closeTag:function(params,content){return '</td>';},restrictParentsTo:["tr"]},"th":{openTag:function(params,content){return '<td>';},closeTag:function(params,content){return '</td>';},restrictParentsTo:["tr"]},"tr":{openTag:function(params,content){return '<tr>';},closeTag:function(params,content){return '</tr>';},restrictChildrenTo:["td","th"],restrictParentsTo:["table","tbody","tfoot","thead"]},"u":{openTag:function(params,content){return '<u>';},closeTag:function(params,content){return '</u>';}},"url":{openTag:function(params,content){var myUrl;if(!params){myUrl=content.replace(/<.*?>/g,"");}else{myUrl=params.substr(1);}
urlPattern.lastIndex=0;if(!urlPattern.test(myUrl)){myUrl="javascript:alert('Invalid link was entered here.');";}
return '<a href="'+myUrl+'" class="popup custom_color" rel="nofollow">';},closeTag:function(params,content){return '</a>';}},"yt":{openTag:function(params,content){var myYouTubeId=content.replace(/<.*?>/g,"");if(myYouTubeId.length!=11){myYouTubeId="";}
if(useIframe()){return '<div class="video-container"><object width="560" height="315"><param name="movie" value="https://www.youtube-nocookie.com/v/'+myYouTubeId+'?rel=0&amp;showsearch=0&amp;showinfo=0"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="https://www.youtube-nocookie.com/v/'+myYouTubeId+'?rel=0&amp;showsearch=0&amp;showinfo=0" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="560" height="315"></embed></object></div>';}else{return '<div class="video-container"><iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/'+myYouTubeId+'?rel=0&amp;showsearch=0&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>';}},closeTag:function(params,content){return '';},displayContent:false},"vimeo":{openTag:function(params,content){var myVimeoUrlId=content.replace(/<.*?>/g,"");if(urlPattern.test(myVimeoUrlId)){myVimeoUrlId="";}
return '<div class="video-container"><iframe src="https://player.vimeo.com/video/'+myVimeoUrlId+'?title=0&amp;byline=0&amp;portrait=1" width="560" height="315" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></div>';},closeTag:function(params,content){return '';},displayContent:false},"rtl":{openTag:function(params,content){return '<div dir="rtl">';},closeTag:function(params,content){return '</div>';}},"ltr":{openTag:function(params,content){return '';},closeTag:function(params,content){return '';}},"*":{openTag:function(params,content){return "<li>";},closeTag:function(params,content){return "</li>";},restrictParentsTo:["list"]}};tagList=[];(function(){var prop,ii,len;for(prop in tags){if(tags.hasOwnProperty(prop)){if(prop==="*"){tagList.push("\\"+prop);}else{tagList.push(prop);if(tags[prop].noParse){tagsNoParseList.push(prop);}}
tags[prop].validChildLookup={};tags[prop].validParentLookup={};tags[prop].restrictParentsTo=tags[prop].restrictParentsTo||[];tags[prop].restrictChildrenTo=tags[prop].restrictChildrenTo||[];len=tags[prop].restrictChildrenTo.length;for(ii=0;ii<len;ii++){tags[prop].validChildLookup[tags[prop].restrictChildrenTo[ii]]=true;}
len=tags[prop].restrictParentsTo.length;for(ii=0;ii<len;ii++){tags[prop].validParentLookup[tags[prop].restrictParentsTo[ii]]=true;}}}})();bbRegExp=new RegExp("<bbcl=([0-9]+) ("+tagList.join("|")+")([ =][^>]*?)?>((?:.|[\\r\\n])*?)<bbcl=\\1 /\\2>","gi");pbbRegExp=new RegExp("\\[("+tagList.join("|")+")([ =][^\\]]*?)?\\]([^\\[]*?)\\[/\\1\\]","gi");pbbRegExp2=new RegExp("\\[("+tagsNoParseList.join("|")+")([ =][^\\]]*?)?\\]([\\s\\S]*?)\\[/\\1\\]","gi");(function(){var closeTagList=[];for(var ii=0;ii<tagList.length;ii++){if(tagList[ii]!=="\\*"){closeTagList.push("/"+tagList[ii]);}}
openTags=new RegExp("(\\[)((?:"+tagList.join("|")+")(?:[ =][^\\]]*?)?)(\\])","gi");closeTags=new RegExp("(\\[)("+closeTagList.join("|")+")(\\])","gi");})();function checkParentChildRestrictions(parentTag,bbcode,bbcodeLevel,tagName,tagParams,tagContents,errQueue){errQueue=errQueue||[];bbcodeLevel++;var reTagNames=new RegExp("(<bbcl="+bbcodeLevel+" )("+tagList.join("|")+")([ =>])","gi"),reTagNamesParts=new RegExp("(<bbcl="+bbcodeLevel+" )("+tagList.join("|")+")([ =>])","i"),matchingTags=tagContents.match(reTagNames)||[],cInfo,errStr,ii,childTag,pInfo=tags[parentTag]||{};reTagNames.lastIndex=0;if(!matchingTags){tagContents="";}
for(ii=0;ii<matchingTags.length;ii++){reTagNamesParts.lastIndex=0;childTag=(matchingTags[ii].match(reTagNamesParts))[2].toLowerCase();if(pInfo.restrictChildrenTo.length>0){if(!pInfo.validChildLookup[childTag]){errStr="The tag \""+childTag+"\" is not allowed as a child of the tag \""+parentTag+"\".";errQueue.push(errStr);}}
cInfo=tags[childTag]||{};if(cInfo.restrictParentsTo.length>0){if(!cInfo.validParentLookup[parentTag]){errStr="The tag \""+parentTag+"\" is not allowed as a parent of the tag \""+childTag+"\".";errQueue.push(errStr);}}}
tagContents=tagContents.replace(bbRegExp,function(matchStr,bbcodeLevel,tagName,tagParams,tagContents){errQueue=checkParentChildRestrictions(tagName,matchStr,bbcodeLevel,tagName,tagParams,tagContents,errQueue);return matchStr;});return errQueue;}
function updateTagDepths(tagContents){tagContents=tagContents.replace(/\<([^\>][^\>]*?)\>/gi,function(matchStr,subMatchStr){var bbCodeLevel=subMatchStr.match(/^bbcl=([0-9]+) /);if(bbCodeLevel===null){return "<bbcl=0 "+subMatchStr+">";}else{return "<"+subMatchStr.replace(/^(bbcl=)([0-9]+)/,function(matchStr,m1,m2){return m1+(parseInt(m2,10)+1);})+">";}});return tagContents;}
function unprocess(tagContent){return tagContent.replace(/<bbcl=[0-9]+ \/\*>/gi,"").replace(/<bbcl=[0-9]+ /gi,"&#91;").replace(/>/gi,"&#93;");}
var replaceFunct=function(matchStr,bbcodeLevel,tagName,tagParams,tagContents){tagName=tagName.toLowerCase();var processedContent=tags[tagName].noParse?unprocess(tagContents):tagContents.replace(bbRegExp,replaceFunct),openTag=tags[tagName].openTag(tagParams,processedContent),closeTag=tags[tagName].closeTag(tagParams,processedContent);if(tags[tagName].displayContent===false){processedContent="";}
return openTag+processedContent+closeTag;};function parse(config){var output=config.text;output=output.replace(bbRegExp,replaceFunct);return output;}
function fixStarTag(text){text=text.replace(/\[(?!\*[ =\]]|list([ =][^\]]*)?\]|\/list[\]])/ig,"<");text=text.replace(/\[(?=list([ =][^\]]*)?\]|\/list[\]])/ig,">");while(text!==(text=text.replace(/>list([ =][^\]]*)?\]([^>]*?)(>\/list])/gi,function(matchStr,contents,endTag){var innerListTxt=matchStr;while(innerListTxt!==(innerListTxt=innerListTxt.replace(/\[\*\]([^\[]*?)(\[\*\]|>\/list])/i,function(matchStr,contents,endTag){if(endTag===">/list]"){endTag="</*]</list]";}else{endTag="</*][*]";}
var tmp="<*]"+contents+endTag;return tmp;})));innerListTxt=innerListTxt.replace(/>/g,"<");return innerListTxt;})));text=text.replace(/</g,"[");return text;};function addBbcodeLevels(text){while(text!==(text=text.replace(pbbRegExp,function(matchStr,tagName,tagParams,tagContents){matchStr=matchStr.replace(/\[/g,"<");matchStr=matchStr.replace(/\]/g,">");return updateTagDepths(matchStr);})));return text;}
me.process=function(config){var ret={html:"",error:false},errQueue=[];config.text=config.text.replace(/(<br\/>|<br \/>|<br>|<br >)/ig,"x6yWQ4Vs");config.text=config.text.replace(/</g,"&lt;");config.text=config.text.replace(/>/g,"&gt;");config.text=config.text.replace(openTags,function(matchStr,openB,contents,closeB){return "<"+contents+">";});config.text=config.text.replace(closeTags,function(matchStr,openB,contents,closeB){return "<"+contents+">";});config.text=config.text.replace(/\[/g,"&#91;");config.text=config.text.replace(/\]/g,"&#93;");config.text=config.text.replace(/</g,"[");config.text=config.text.replace(/>/g,"]");while(config.text!==(config.text=config.text.replace(pbbRegExp2,function(matchStr,tagName,tagParams,tagContents){tagContents=tagContents.replace(/\[/g,"&#91;");tagContents=tagContents.replace(/\]/g,"&#93;");tagParams=tagParams||"";tagContents=tagContents||"";return "["+tagName+tagParams+"]"+tagContents+"[/"+tagName+"]";})));config.text=fixStarTag(config.text);config.text=addBbcodeLevels(config.text);errQueue=checkParentChildRestrictions("bbcode",config.text,-1,"","",config.text);ret.html=parse(config);if(ret.html.indexOf("[")!==-1||ret.html.indexOf("]")!==-1){errQueue.push("Some tags appear to be misaligned.");}
if(config.removeMisalignedTags){ret.html=ret.html.replace(/\[.*?\]/g,"");}
if(config.addInLineBreaks){ret.html=ret.html.replace(/\r\n/g,"\n");ret.html=ret.html.replace(/(\r|\n)/g,"$1<br/>");}
ret.html=ret.html.replace("&#91;","[");ret.html=ret.html.replace("&#93;","]");ret.html=ret.html.replace(/x6yWQ4Vs/g,"<br/>");ret.error=(errQueue.length===0)?false:true;ret.errorQueue=errQueue;return ret;}
return me;})();